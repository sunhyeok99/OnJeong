# 온정 (온라인 情(뜻 정) / 亭(정자 정))

## 프로젝트 설명
어르신들이 물리적 제약을 극복하기 위해 가족, 지인들과 영상통화를 하고, <br>
디지털 소외를 해소하기 위해 실시간 응답 서비스를 제공하고, <br>
디지털 접근성을 향상 시킬 수 있는 부가 기능을 제공하는 서비스

## 기술
### App
- Android Studio

### Server
- Java 17 (OpenJDK 17)
- Spring boot 3.2.1
    - 의존성 관리
    - Auto Configuration
- Spring Data JPA
    - 객체 중심의 ORM 쿼리 활용
- Spring security
    - JWT 기반 토큰을 활용한 인증
    - ExceptionEntryPoint를 활용한 예외 처리
- Firebase
    - 화상통화 푸쉬 알림을 통한 편의성 증대

### DB
- MySQL
    - 테이블의 성격을 고려한 객체 중심의 엔티티 설계
    - N:M 관계를 조인 테이블을 활용해 1:N, M:1로 풀어내 개발 복잡도 저하

### Infra

- Jenkins
    - CI / CD 구축을 통한 개발 효율성 증가
- Openvidu
    - 화상통화 구현 플랫폼
- Docker
- Docker hub
    - 이미지 업로드를 통한 버전 관리에 활용

### Cloud

- AWS EC2
- AWS S3
    - 회원 프로필 사진 저장

## 기능 리스트

### 1. 회원가입/로그인
- 카카오 로그인 지원
- JWT 토큰 인증 기반
- 전화번호 인증

### 2. 날씨
- 공공 데이터 포털 API에서 날씨 정보 추출
- GPS를 통해 현재 주소 조회
- 현재날짜부터 일주일 후 까지 다음 정보 제공
    - 현재 기온
    - 최저/최고 기온
    - 하늘 상태 (맑음, 구름 많음, 흐림)
    - 강수 형태 (없음, 비, 비/눈, 눈, 소나기)

### 3. 뉴스
- 네이버 뉴스를 크롤링하여 실시간으로 제공
- 5개의 카테고리 - 정치, 경제, 사회, 생활, 세계

### 4. 영상통화
- 생성된 모임과 유저 조회 및 선택
- 다대다 영상통화 기능
- 초대받은 사람에게 알람

### 5. 상담원 연결
- 상담원 개인 상담 방 생성/삭제
- 상담원과 클라이언트 영상 상담 기능

### 6. 복지 서비스
- 복지 서비스 Open API를 이용한 복지 목록 조회

### 7. 온라인 교육 동영상
- Youtube ID 값을 이용한 영상 재생

### 8. 게임
- 퍼즐 게임, 짝 맞추기 게임
- 각 게임마다 점수 기준으로 랭크 계산 및 조회

### 9. 마이페이지
- 회원 정보 조회 (이름, 전화번호, 프로필 이미지)
- 프로필 이미지, 전화번호 수정
- 모임 설정
    - 모임 생성 및 수정 (이름, 유저 리스트)
    - 모임 삭제
- 연락처 동기화 (사용자의 연락처와 온정 회원을 비교)
- 로그아웃

### 10. 푸시 알람
- FCM 토큰 관리
- 영상통화 초대 시 푸시 알람 요청 (헤드업 알림)

## 주요페이지 

### 로그인 페이지
|<img src ="https://github.com/slside/Baekjoon/assets/132821972/a5717afb-df49-4d01-b48a-32f3d76fb6b5" width="250" height="450">|
|:---:|
|로그인 페이지|
- 카카오 소셜 로그인을 통해 접속할 수 있습니다.
- 처음 접속에만 등록을 진행하며 그 이후부터는 자동로그인이 진행됩니다

### 메인페이지
|<img src ="https://github.com/slside/Baekjoon/assets/132821972/c49883be-9dba-4293-83d2-e4608e089660" width="250" height="450">|
|:---:|
|메인페이지|

- 8가지 기능의 아이콘을 크게 만들어 조작하기 쉽도록 만들었습니다.

### 마이페이지
|<img src ="https://github.com/slside/Baekjoon/assets/132821972/5ab2d12b-10e1-4135-9048-f6d4abe6c15e" width="250" height="450">|<img src ="https://github.com/slside/Baekjoon/assets/132821972/327faaae-f055-438a-8636-9d52734e9779" width="250" height="450">|
|:---:|:---:|
|모임관리|연락처 동기화|

- 연락처 동기화를 통해 현재 핸드폰에 저장된 연락처를 가져올 수 있습니다.
- 프로필 사진을 클릭하면 프로필 사진 변경이 가능합니다.
- 모임 설정을 통해 영상통화 할 인원들을 설정할 수 있습니다.

### 영상통화
|<img src ="https://github.com/slside/Baekjoon/assets/132821972/c71de997-4877-427a-b414-aa64ae19c332" width="250" height="450">|<img src ="https://github.com/slside/Baekjoon/assets/132821972/62914949-27b6-480a-bd65-e05b8bc89984" width="250" height="450">|
|:---:|:---:|
|영상통화 만들기|알림 받고 입장|

- 생성된 모임내에서도 원하는 사람을 선택해 영상통화를 할 수 있습니다.
- 어플에 접속하지 않은 상태이면 어플 푸쉬알림을 받을 수 있습니다.
- 어플내에 접속하고 있다면 상단에 알림을 통해 접속할 수 있으며 방 생성자의 이름 확인이 가능합니다.

### 상담원통화
|<img src ="https://github.com/slside/Baekjoon/assets/132821972/97cd31b4-4ad5-42ec-aea7-2f572ca00744" width="250" height="450">|
|:---:|
|상담원 통화|

- 도움이 필요한 경우 상담원 연결 버튼을 통해 접속할 수 있습니다.
- 기존 상담원이 있는 방에 연결되는 방식으로 짧은 대기시간을 가질 수 있습니다.

### 날씨
|<img src ="https://github.com/slside/Baekjoon/assets/132821972/ad089d58-c19c-4b76-b439-878520316e86" width="250" height="450">|
|:---:|
|날씨|

- 현재 위치를 기준으로 날씨를 확인할 수 있습니다.
- 일주일간의 최고온도, 최저온도, 기후를 확인 가능합니다.

### 뉴스
|<img src ="https://github.com/slside/Baekjoon/assets/132821972/63053af0-4273-45a2-9d56-3f913afdd852" width="250" height="450">|
|:---:|
|뉴스|

- 카테고리별로 관심있는 기사를 제공받을 수 있습니다.
- 제공된 기사는 헤드라인의 기사로 실시간으로 변경되는 최신 기사를 제공받을 수 있습니다.
- 관심있는 기사는 원문으로 이동하여 추가 정보를 확인 가능합니다.

### 복지서비스
|<img src ="https://github.com/slside/Baekjoon/assets/132821972/385ff0d7-61ad-49fc-b11e-fea60d7b727b" width="250" height="450">|
|:---:|
|복지서비스|

- 추가 정보를 확인하고 싶은 복지에 대해 이동하여 확인할 수 있습니다.

### 온라인교육
|<img src ="https://github.com/slside/Baekjoon/assets/132821972/0df3059a-b503-4a16-9b0e-a229423dc584" width="250" height="450">|
|:---:|
|온라인교육|

- 온라인 교육탭에서는 어르신들에게 필요한 영상을 제공합니다.
- 영상은 유튜브 연동을 통해 어플에서 간편하게 시청할 수 있습니다.

### 게임
|<img src ="https://github.com/slside/Baekjoon/assets/132821972/776a6040-0358-44d4-a90a-3e7487d4b6cb" width="250" height="450">|<img src ="https://github.com/slside/Baekjoon/assets/132821972/a3c36d89-62e1-46dd-8275-d1256478fc17" width="250" height="450">|<img src ="https://github.com/slside/Baekjoon/assets/132821972/c1810c6c-18de-4690-8f65-96e4602d9078" width="250" height="450">|
|:---:|:---:|:---:|
|퍼즐게임|짝맞추기게임|랭킹페이지|

- 게임 탭에서는 두 가지 게임을 제공하며 점수에 대한 순위도 확인할 수 있습니다.
- 퍼즐게임은 기존의 애니팡과 유사한 방법으로 플레이할 수 있고, 게임 도중 일시정지 버튼을 통해 나가거나 이어할 수 있습니다.
- 짝 맞추기 게임은 기억력 증진을 위한 게임으로 3초간 색의 위치를 기억한 후 같은 색의 블럭을 맞추면 됩니다. 


## 아키텍쳐
![](https://velog.velcdn.com/images/tyjk8997/post/a3150a75-9113-43c6-bb42-752be2af423b/image.png)

## ERD
![](https://velog.velcdn.com/images/tyjk8997/post/ca8d7e9c-0dac-4c32-8367-4479e520579d/image.png)

## 개선 과정
- 회원가입/로그인
    - 노인들이 사용하기 쉽도록 카카오 로그인 적용
    - JWT를 활용하여 stateless한 상태 유지

- 날씨
    - 데이터를 캐싱하여 성능 향상
        - 시간당 API 호출량이 대량으로 몰릴때 공공데이터 포털에서 요청 거부
        - 매번 API를 호출하는게 아닌 base_time을 기준으로 데이터를 캐싱
        - **Error 평균 : 62% → 0%**
    - 락을 통해 동시성 문제 해결
    - 변하는 부분과 변하지 않는 부분을 나누어 전략 패턴을 적용
        - 추가로 날씨와 관련된 API를 호출하는 기능이 생긴다면 클라이언트를 건드릴 필요없이 날씨 전략 인터페이스를 구현만 하면됨
        - 유지보수 용이
    - 올바른 인덱스 설계를 통해 쿼리 성능 개선
        - **Response Time : 71.8% 감소**
         - **Throughput : 73% 증가**

- 뉴스 
    - 뉴스를 분야별로 접할 수 있도록 분야별 사이트 웹 크롤링 사용
    - 프론트단에서 정적 크롤링을 사용하여 실행속도 증가
    - 크롤링 과정 중 코루틴을 사용하여 비용 절감, 복잡성 저하

- 게임 
    - 유저의 게임 점수를 조회할 때 마다 지연로딩으로 쿼리문이 N+1번 발생하는 문제에서 Fetch Join 사용
